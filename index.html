<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <a href="./Document/index.html">Document</a>
    <hr />
    demos:<br />
    <a href="App/demo/CSG/index.html">CSG</a><br />
    <a href="App/demo/LOD/index.html">LOD</a><br />
    <a href="App/demo/MeshVisualizer/index.html">MeshVisualizer</a><br />
    <a href="App/demo/physics/helloworld.html">physics/helloworld</a><br />
    <a href="App/demo/physics/cloth.html">physics/cloth</a><br />
    <a href="App/demo/physics/vehicle.html">physics/vehicle</a><br />
    <a href="App/demo/physics/terrain.html">physics/terrain</a><br />
    <a href="App/demo/physics/softbody_volume.html">physics/softbody_volume</a><br />
    <a href="App/demo/physics/softbody_volume2.html">physics/softbody_volume2</a><br />
    <a href="App/demo/physics/softbody_rope.html">physics/softbody_rope</a><br />
    <a href="App/demo/ReferenceMesh/index.html">ReferenceMesh</a><br />
    <a href="App/demo/VolumeRendering/index.html">VolumeRendering</a><br />
    
    <article class="markdown-body entry-content" itemprop="text"><p>#CesiumMeshVisualizer
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/Document/index.html" rel="nofollow">Document</a>
</p><hr>
&nbsp;  demos（示例中常用操作有：左击发射，Q、A——左、右摆动，W、S、A、D——前进、后退、左转弯、右转弯）:<br><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/CSG/index.html" rel="nofollow">
<img src="https://camo.githubusercontent.com/a8c8f6ff57f1ccbb671c824bdafc0bb6e4fe5aee/68747470733a2f2f6d696b65737765692e6769746875622e696f2f43657369756d4d65736856697375616c697a65722f4170702f64656d6f2f4353472f73637265656e73686f742e6a7067" data-canonical-src="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/CSG/screenshot.jpg" style="max-width:100%;">
</a><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/CSG/index.html" rel="nofollow">CSG</a><br><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/LOD/index.html" rel="nofollow">
<img src="https://camo.githubusercontent.com/b4e3f6b1dd391b730630ae040dc4ecbb2654a3ba/68747470733a2f2f6d696b65737765692e6769746875622e696f2f43657369756d4d65736856697375616c697a65722f4170702f64656d6f2f4c4f442f73637265656e73686f742e6a7067" data-canonical-src="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/LOD/screenshot.jpg" style="max-width:100%;">
</a><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/LOD/index.html" rel="nofollow">LOD</a><br><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/MeshVisualizer/index.html" rel="nofollow">MeshVisualizer</a><br><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/helloworld.html" rel="nofollow">physics/helloworld</a><br><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/cloth.html" rel="nofollow">
<img src="https://camo.githubusercontent.com/8455119c22189212271c6189449eae09886563cc/68747470733a2f2f6d696b65737765692e6769746875622e696f2f43657369756d4d65736856697375616c697a65722f4170702f64656d6f2f706879736963732f636c6f74682e6a7067" data-canonical-src="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/cloth.jpg" style="max-width:100%;">
</a><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/cloth.html" rel="nofollow">physics/cloth</a><br><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/vehicle.html" rel="nofollow">
<img src="https://camo.githubusercontent.com/49be6674f2c1e505b4309bd07461b7beb3ccd59d/68747470733a2f2f6d696b65737765692e6769746875622e696f2f43657369756d4d65736856697375616c697a65722f4170702f64656d6f2f706879736963732f76656869636c652e6a7067" data-canonical-src="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/vehicle.jpg" style="max-width:100%;">
</a><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/vehicle.html" rel="nofollow">physics/vehicle</a><br><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/terrain.html" rel="nofollow">
<img src="https://camo.githubusercontent.com/c1c7196092c5eb3c34cf43e6aceaa5dbadb94f22/68747470733a2f2f6d696b65737765692e6769746875622e696f2f43657369756d4d65736856697375616c697a65722f4170702f64656d6f2f706879736963732f7465727261696e2e6a7067" data-canonical-src="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/terrain.jpg" style="max-width:100%;">
</a><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/terrain.html" rel="nofollow">physics/terrain</a><br><br><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/softbody_volume.html" rel="nofollow">
<img src="https://camo.githubusercontent.com/76f882c47fb158c7c6d92875f369a0692cf6ddd3/68747470733a2f2f6d696b65737765692e6769746875622e696f2f43657369756d4d65736856697375616c697a65722f4170702f64656d6f2f706879736963732f736f66745f766f6c756d652e6a7067" data-canonical-src="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/soft_volume.jpg" style="max-width:100%;">
</a><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/softbody_volume.html" rel="nofollow">physics/softbody_volume</a><br><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/softbody_volume2.html" rel="nofollow">
<img src="https://camo.githubusercontent.com/dd7791a18cb63f37257c84835532a207e747d97e/68747470733a2f2f6d696b65737765692e6769746875622e696f2f43657369756d4d65736856697375616c697a65722f4170702f64656d6f2f706879736963732f736f66745f766f6c756d65322e6a7067" data-canonical-src="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/soft_volume2.jpg" style="max-width:100%;">
</a><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/softbody_volume2.html" rel="nofollow">physics/softbody_volume2</a><br><br><p></p>
   <a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/softbody_rope.html" rel="nofollow">
       <img src="https://camo.githubusercontent.com/dfd4a6010d2a5f3fd145cd5918e2fc7350180ec5/68747470733a2f2f6d696b65737765692e6769746875622e696f2f43657369756d4d65736856697375616c697a65722f4170702f64656d6f2f706879736963732f736f66745f726f70652e6a7067" data-canonical-src="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/soft_rope.jpg" style="max-width:100%;">
    </a><br> 
   <a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/softbody_rope.html" rel="nofollow">physics/softbody_rope</a><br><br>
<p><a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/ReferenceMesh/index.html" rel="nofollow">ReferenceMesh</a><br><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/VolumeRendering/index.html" rel="nofollow">
<img src="https://camo.githubusercontent.com/6d5eb91ff5bf6cdcdb23d8b41eaf549727aa5236/68747470733a2f2f6d696b65737765692e6769746875622e696f2f43657369756d4d65736856697375616c697a65722f4170702f64656d6f2f566f6c756d6552656e646572696e672f73637265656e73686f742e6a7067" data-canonical-src="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/VolumeRendering/screenshot.jpg" style="max-width:100%;">
</a><br>
<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/VolumeRendering/index.html" rel="nofollow">VolumeRendering</a><br></p>
<p>Example<br></p>
<pre><code>    MeshVisualizer = Cesium.MeshVisualizer;
    Mesh = Cesium.Mesh;
    MeshMaterial = Cesium.MeshMaterial; 
    FramebufferTexture = Cesium.FramebufferTexture;

    var center = Cesium.Cartesian3.fromDegrees(homePosition[0], homePosition[1], 50000);
    var modelMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(center);

    var meshVisualizer = new MeshVisualizer({
        modelMatrix: modelMatrix,
    });
    viewer.scene.primitives.add(meshVisualizer);


    //示例1：Cesium.Geometry+Cesium.MeshMaterial组合
    var box = Cesium.BoxGeometry.createGeometry(Cesium.BoxGeometry.fromDimensions({
        dimensions: new Cesium.Cartesian3(100000, 50000, 50000),
        vertexFormat: Cesium.VertexFormat.POSITION_ONLY
    }));
    
    var material = new MeshMaterial({
        defaultColor: "rgba(255,0,0,1.0)",
        wireframe: false,
        side: MeshMaterial.Sides.DOUBLE
    });
    var boxMesh = new Mesh(box, material);

    meshVisualizer.add(boxMesh);

    //示例2：Cesium.CSG+Cesium.MeshMaterial组合，可以用Cesium.CSG做布尔运算并渲染运算结果

    //首先使用Cesium创建球体
     var sphere = new Cesium.SphereGeometry({
         radius: 50000.0,
         vertexFormat: Cesium.VertexFormat.POSITION_ONLY
     });
     sphere = Cesium.SphereGeometry.createGeometry(sphere);
    
     var sphereMesh = new Mesh(sphere, material);
     sphereMesh.position = new Cesium.Cartesian3(100000, 0, 0)
     meshVisualizer.add(sphereMesh);

     //将球体对象Cesium.SphereGeometry转成Cesium.CSG实例
     sphere = CSG.toCSG(sphere);
     //将盒子对象转成Cesium.CSG实例
     box = CSG.toCSG(box);

      //做布尔运算
      var subResult = sphere.subtract(box);
      //渲染运算结果
      var subResultMesh = new Mesh(subResult, material);
      subResultMesh.position = new Cesium.Cartesian3(700000, 0, 0)
      meshVisualizer.add(subResultMesh);

      //示例3：使用帧缓存作纹理,实际应用中如体绘制，风场流场绘制等等都可以运用此技术

      function createGeometry() {
        var p1 = new Cesium.Cartesian3(-50000, 50000, 100);
        var p2 = new Cesium.Cartesian3(-50000, -50000, 100);
        var p3 = new Cesium.Cartesian3(50000, -50000, 100);
        var p4 = new Cesium.Cartesian3(50000, 50000, 100);

        var positions = new Float64Array([
          p1.x, p1.y, p1.z,
          p2.x, p2.y, p2.z,
          p3.x, p3.y, p3.z,
          p4.x, p4.y, p4.z
        ]);
        var indices = new Uint16Array([
          0, 1, 3,
          1, 2, 3,
        ]);
        var sts = new Float32Array([
          1, 1,
          1, 0,
          0, 0,
          0, 1
        ]);
        var geometry = new Cesium.Geometry({
            attributes: {
                position: new Cesium.GeometryAttribute({
                    componentDatatype: Cesium.ComponentDatatype.DOUBLE,
                    componentsPerAttribute: 3,
                    values: positions
                }),
                st: new Cesium.GeometryAttribute({
                    componentDatatype: Cesium.ComponentDatatype.FLOAT,
                    componentsPerAttribute: 2,
                    values: sts
                })
            },
            indices: indices,
            primitiveType: Cesium.PrimitiveType.TRIANGLES,
            boundingSphere: Cesium.BoundingSphere.fromVertices(positions)
        });

        return geometry;
    }
    //将上文中的盒子渲染到缓存，作为纹理参与createGeometry（）方法创建的几何体渲染过程
    var framebufferTex = new FramebufferTexture(boxMesh);
    var geometry = createGeometry();
    var customMesh = new Mesh(geometry, new MeshMaterial({

        uniforms: {
            u_textureMap: framebufferTex//Cesium.buildModuleUrl('Widgets/Images/TerrainProviders/STK.png')
        },
        side: MeshMaterial.Sides.DOUBLE,
        vertexShader : "\n\
            \n\
            varying vec3 v_position;\n\
            varying vec2 v_st;\n\
            \n\
            void main(void) \n\
            {\n\
            vec4 pos = u_modelViewMatrix * vec4(position,1.0);\n\
            v_position = pos.xyz;\n\
            v_st=st;\n\
            gl_Position = u_projectionMatrix * pos;\n\
            }",
        fragmentShader : "varying vec2 v_st;\
            uniform sampler2D u_textureMap;\
            void main()\
            {\
            gl_FragColor = texture2D(u_textureMap,v_st);\n\
            \
            }\
            "
    }));
    customMesh.position = new Cesium.Cartesian3(100000, 0, 0);
    meshVisualizer.add(customMesh);
</code></pre>
<p>携源码示例和文档，诚意奉献，<a href="https://github.com/MikesWei/CesiumMeshVisualizer">https://github.com/MikesWei/CesiumMeshVisualizer</a> ， 名字不重要。 <br>
个人觉得Threejs里的Mesh、Geometry、Material极好，尤其是各个属性可以独立地、动态地编辑的特点，是目前在Cesium的Primitive中没有充分体现的。比如
你渲染一个立方体，想要旋转，竟然还需要自己去算新的ModelMatrix；再比如画个波动的水面竟然不能只修改顶点位置属性，修改完顶点位置后竟然需要移除旧的
Primitive再创建一个。。。也许我没找到接口，但是真心难找啊！还好，稍微扒过Cesium Primitive的都知道，再往稍微底层一点的还有DrawCommand可以灵活使用，
但是也太灵活，代码量大，还容易出错，所以决定自己模仿Threejs的Mesh、Geometry、Material并实现一个负责渲染和管理它们的更支持动态管理可渲染对象的
Primitive；之前的思路是直接转换Threejs的Mesh，产物就是<a href="https://github.com/MikesWei/cesium3js">Cesium3js</a>，但是名字太大，误以为是要完全整合Cesium和Threejs，这与我本意不符,遂重新整理优化：
<br></p>
<ul>
<li>1、不直接支持threejs的mesh，但是支持Threejs的Geometry和BufferGeometry来构建几何体。内置了Threejs Geometry、BufferGeometry到Cesium.Geometry的转换接口，同时提供Cesium.Geometry到Threejs BufferGeometry的转换接口。这些接口由<a href="https://mikeswei.github.io/CesiumMeshVisualizer/Document/Cesium.GeometryUtils.html" rel="nofollow">GeometryUtils</a>类提供。</li>
<li>2、定义Mesh，支持Cesium.Geometry、THREE.Geometry、THREE.BufferGeometry以及<a href="https://mikeswei.github.io/CesiumMeshVisualizer/Document/Cesium.CSG.html" rel="nofollow">CSG</a>运算结果模型。</li>
<li>3、更方便的动态渲染和管理。同一个mesh，可以单独修改mesh的位置(position)、缩放(scale)、旋转角度(rotation/Quaternion)等属性；也可以单独修改
geometry和material；同一个geometry可以单独修改各个属性和索引。方便管理，且减少对象的局部变化带来的整个drawCommand重新构建次数，以期在更多动态渲染
对象同时改变的情况下（比如结合物理引擎做模拟），仍然保持较高的帧率，当然也牺牲了一定的内存。</li>
<li>4、定义<a href="https://mikeswei.github.io/CesiumMeshVisualizer/Document/Cesium.MeshMaterial.html" rel="nofollow">MeshMaterial</a>，目的是更方便的引用Threejs圈的那些炫酷特效Shader，减少整合所需的代码量。尤其是Cesium的Appearance从fragmentShader中分离出Material部分的Shader，并且作用域不一样之后，带来好多不便，引入网上那些炫酷特效Shader的时候真是头疼死了，谁做过谁才解其中味~   <a href="https://mikeswei.github.io/CesiumMeshVisualizer/Document/Cesium.MeshMaterial.html" rel="nofollow">MeshMaterial</a>区别于Cesium的Material，更像Threejs的Material,但不完全是。。。好像有点四不像~</li>
<li>5、定义<a href="https://mikeswei.github.io/CesiumMeshVisualizer/Document/Cesium.FramebufferTexture.html" rel="nofollow">FramebufferTexture</a>，启发于Threejs的RenderTarget，暂且叫帧缓存纹理类吧，反正名字不重要~ MeshVisualizer和MeshMaterial一起支持此类纹
理，就当是普通的一张图片纹理就好了。它的用处就是，把Mesh渲染到帧缓存中，作为纹理参与其他Mesh的渲染。可以参考<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/VolumeRendering/index.html" rel="nofollow">VolumeRendering示例</a>。另外RendererUtils
提供了一个单次执行渲染到纹理的接口<a href="https://mikeswei.github.io/CesiumMeshVisualizer/Document/Cesium.RendererUtils.html" rel="nofollow">RendererUtils</a>.renderToTexture。在不使用<a href="https://mikeswei.github.io/CesiumMeshVisualizer/Document/Cesium.MeshVisualizer.html" rel="nofollow">MeshVisualizer</a>的时候，也就是自己基于drawCommand自定义一个Primitive的时
候也可以用得上。</li>
<li>6、整合<a href="https://github.com/evanw/csg.js">CSG.js</a>，支持使用Cesium.Geometry、THREE.Geometry、THREE.BufferGeometry做交、并、补等运算，并提供将运算结果CSG对象转成Cesium.Geometry、THREE.Geometry的接口。参考<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/CSG/index.html" rel="nofollow">CSG示例</a>。</li>
<li>7、提供基于<a href="https://github.com/kripken/ammo.js">ammo.js</a>物理引擎的示例，<a href="https://mikeswei.github.io/CesiumMeshVisualizer/App/demo/physics/helloworld.html" rel="nofollow">示例</a>源码源于Threejs，使用<a href="https://mikeswei.github.io/CesiumMeshVisualizer/Document/Cesium.MeshVisualizer.html" rel="nofollow">MeshVisualizer</a>，可以在更少的代码修改情况下完成迁移整合，甚合我意。</li>
</ul>
</article>
</body>
</html>
